package src.sauvegarde;

import src.PartieCourante;
import src.menus.MenuRepriseSauvegarde;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.util.ArrayList;
import java.util.List;

public class Sauvegarder {
    
    public static void creerSauvegarde(PartieCourante partieCourante) {
        try {
        	String pwd = System.getProperty("user.dir");
        	File dossier = new File(pwd + "/sauvegarde/");
        	if (!dossier.exists() || !dossier.isDirectory()) {
        		dossier.mkdir();
        	}
        	// Cr√©ation de la liste des villes ou reprise de l'existante
        	File fichierVilles = new File(pwd + "/sauvegarde/Villes_Sauvegardees.save");
        	List<String> listeVilles;
        	if (fichierVilles.exists()) {
                FileInputStream fis = new FileInputStream(pwd + "/sauvegarde/Villes_Sauvegardees.save");
                ObjectInputStream ois = new ObjectInputStream(fis);
                listeVilles = (List<String>) ois.readObject();
                ois.close();
        	} else {
        		listeVilles = new ArrayList<String>();
        	}
        	String nomPartie = partieCourante.getNom();
            if (!listeVilles.contains(partieCourante.getNom())) {
                listeVilles.add(nomPartie);
                FileOutputStream fosv = new FileOutputStream(pwd + "/sauvegarde/Villes_Sauvegardees.save");
                ObjectOutputStream osv = new ObjectOutputStream(fosv);
                osv.writeObject(listeVilles);
                osv.close();
            }
            MenuRepriseSauvegarde.setListeVille(listeVilles);
        	
        	// Sauvegarde de la partie
            FileOutputStream fosp = new FileOutputStream(pwd + "/sauvegarde/" + nomPartie + ".city");
            ObjectOutputStream osp = new ObjectOutputStream(fosp);
            osp.writeObject(partieCourante);
            osp.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    public static PartieCourante reprendreSauvegarde(String nomPartie) throws FileNotFoundException {
        try {
        	String pwd = System.getProperty("user.dir");
        	File dossier = new File(pwd + "/sauvegarde/");
        	if (!dossier.exists() || !dossier.isDirectory()) {
        		throw new FileNotFoundException();
        	}
            FileInputStream fis = new FileInputStream(pwd + "/sauvegarde/" + nomPartie + ".city");
            ObjectInputStream ois = new ObjectInputStream(fis);
            PartieCourante partieCourante = (PartieCourante) ois.readObject();
            ois.close();
            partieCourante.setTimer();
            return partieCourante;
        } catch (FileNotFoundException e) {
        	throw new FileNotFoundException();
        } catch (Exception e) {
        	e.printStackTrace();
        }
		return null;
    }
}
